---
layout: post
title: 2024 신기술분야 전문가 과정 연수, 가상공간 구현 수업설계
category: education
tags: AI
teaser: 
---

# 2024 신기술분야 전문가 과정 연수, 가상공간 구현 수업설계

## 강사 소개
* 16년차 프로그래머 (action script, c++, c#, html, css, java script, php)
  * AR, VR, 피지컬 컴퓨팅, 메타버스
* 9년차 전문대학교 강사 (디자인 대학생 대상 프로그래밍 교육)
  * Unity3D, Arduino, 프론트엔드, 백엔드

* [introduction 교수소개](/education/2024/03/02/introduction.html){:target="_blank"}
* [이력서](/profile/){:target="_blank"}

---

## 새 프로젝트 만들기
* [새 프로젝트 만들기](/subpage/2024/08/04/new_project.html){:target="_blank"}

---

## 아바타
* [Ready Player Me 아바타](/subpage/2024/08/04/ready_player_me.html){:target="_blank"}
* [Oculus Lipsync Unity](/subpage/2024/08/04/lipsync.html){:target="_blank"}

---

## NuGetForUnity 설치하기
* [NuGetForUnity](/subpage/2024/08/04/nuget_for_unity.html){:target="_blank"}

## OpenAI 키 생성 및 환경변수 등록
* [OpenAI API](/subpage/2024/08/04/openai.html){:target="_blank"}
* [OpenAI API key 환경변수 등록](/subpage/2024/08/04/openai_key.html){:target="_blank"}

---

## OpenAI Unity Library
* [OpenAI API Dotnet](/subpage/2024/08/04/openai_api_dotnet.html){:target="_blank"}

### ChatGPT 챗봇
* [ChatGPT TTS (Text-To-Speech)](/subpage/2024/08/04/chatgpt_tts.html){:target="_blank"}
* [ChatGPT 챗봇](/subpage/2024/08/04/ChatGPT_chatbot.html){:target="_blank"}
* [ChatGPT STT (Speech-To-Text)](/subpage/2024/08/04/chatgpt_stt.html){:target="_blank"}
* STT(목소리를 글자로) -> ChatGPT 질문 -> ChatGPT 답문 -> TTS(글자를 목소리로)

<img style='border:solid 1px black;' src="https://image.onethelab.com/resized/1722788708.jpg" />

* 3개의 c# script를 다 만들고 나면 Avatar의 Renderer_head부분에 드래그 드랍하여 전달합니다.

---

## 캐릭터 성격 및 전용 지식 만들기

<img style='border:solid 1px black;' src="https://image.onethelab.com/resized/1722792662.jpg" />

* Open AI Controller에서 Personality, Scene 내용을 수정하여 추가 정보를 입력할 수 있다
* Sample_message를 추가하여 대화의 예시를 만들수 있다. 보통은 User의 질문에 Assistant가 답하는 방식으로 나열
* 하단의 + 버튼을 눌러서 계속 추가

---

## 2일차
* [Unity Terrain 지형 만들기](/unity3d/2024/04/28/unity_terrain.html){:target="_blank"}
* [Unity 반투명 이미지 객체 만들기](/unity3d/2024/04/28/Unity_transparent_png.html){:target="_blank"}
* [Unity Post Processing 포스트프로세싱](/unity3d/2024/05/09/unity_post_processing.html){:target="_blank"}

---
## OpenAiAnimator
```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

[System.Serializable]
public class triggers
{
    public string word="안녕";
    public string animation_name = "hand_shake";
}

public class OpenAIAnimator : MonoBehaviour
{

    public Animator target_animator;
    public string default_talk_animation = "talking";
    public triggers[] trigger_list;
    public void checkWordInChat(string chat)
    {
        foreach (triggers trigger in trigger_list)
        {
            if (chat.Contains(trigger.word))
            {
                target_animator.Play(trigger.animation_name);
                return;
            }
        }
        target_animator.Play(default_talk_animation);
    }
}
```
## OpenAiController
```c#
using System;
using System.Collections.Generic;
using OpenAI_API;
using OpenAI_API.Chat;
using OpenAI_API.Models;
using UnityEngine;


public enum ChatMessageSampleRole
{
    System,
    User,
    Assistant
}

[System.Serializable]
public class ChatMessageSample
{
    public ChatMessageSampleRole role = ChatMessageSampleRole.System;
    public string content = "Hello, World!";
}

public class OpenAIController : MonoBehaviour
{
    private OpenAIAPI api;
    private List<ChatMessage> messages;
    private Conversation chat;
    // Start is called before the first frame update
    private OpenAI_TTS tts;
    private OpenAIAnimator animator;
    void Start()
    {
        api = new OpenAIAPI(Environment.GetEnvironmentVariable("OPENAI_API_KEY", EnvironmentVariableTarget.User));
        tts = gameObject.GetComponent<OpenAI_TTS>(); 
        animator = gameObject.GetComponent<OpenAIAnimator>();
        StartConversation();
    }

    public int maxResponseWordLimit = 10;

    [TextArea(3, 10)]
    public string personality = "수학에 관련된 답변만 해줍니다. 수학의 역사, 수에 관한 재밌는 이야기 등. 수학과 관련이 있다면 다른 과목이라도 답변을 해줍니다. 답변의 마지막엔 수학에 관한 재미있는 이야기를 하나 알려줍니다. 도덕적으로 옳지 못한것을 바로잡아줍니다.";
    [TextArea(3, 10)]
    public string scene = "교실입니다.";

    public ChatMessageSample[] sample_message; 
    public void StartConversation()
    {
        string defult_content = "You are a teacher and will answer to the message the player ask you. \n" +
            "You must reply to the player message only using the information from your Personnality and the Scene that are provided afterwards. \n" +
            "Do not invent or create response that are not mentionned in these information. \n" +
            "Do not break character or mention you are an AI or a teacher. \n" +
            "You must answer in less than " + maxResponseWordLimit + "words. \n" +
            "Here is the information about your Personnality : \n" + personality + "\n" +
            "Here is the information about the Scene around you : \n" + scene + "\n" +
            "Here is the message of the player : \n";
        messages = new List<ChatMessage>{
            new ChatMessage(ChatMessageRole.System, defult_content)
        };

        foreach (var item in sample_message)
        {
            if (ChatMessageSampleRole.System == item.role)
                messages.Add(new ChatMessage(ChatMessageRole.System, item.content));
            else if (ChatMessageSampleRole.User == item.role)
                messages.Add(new ChatMessage(ChatMessageRole.User, item.content));
            else if (ChatMessageSampleRole.Assistant == item.role)
                messages.Add(new ChatMessage(ChatMessageRole.Assistant, item.content));
        }
    }

    public async void GetResponse(string ins_input_string = null)
    {
        Debug.Log("GetResponse");
        if (ins_input_string != null) input_string = ins_input_string;
        if (input_string.Length < 1) return;
        isTypeable = false; //typing lock

        ChatMessage userMessage = new ChatMessage();
        userMessage.Role = ChatMessageRole.User;
        userMessage.TextContent = input_string;
        if (userMessage.TextContent.Length > 100)
        {
            // limit message length to 100 characters
            userMessage.TextContent = userMessage.TextContent.Substring(0, 100);
        } 
        output_string += string.Format("{0}:{1}", userMessage.rawRole, userMessage.TextContent) + "\n";
        Debug.Log(output_string);
        messages.Add(userMessage);

        input_string = ""; //clear the input field

        //Send the message to the API
        var chatResult = await api.Chat.CreateChatCompletionAsync(
            new ChatRequest()
            {
                Model = Model.ChatGPTTurbo,
                Temperature = 0.1,
                MaxTokens = 150,
                Messages = messages
            }
        );

        //get the response
        ChatMessage responseMessage = new ChatMessage();
        responseMessage.Role = chatResult.Choices[0].Message.Role;
        responseMessage.TextContent = chatResult.Choices[0].Message.TextContent;
        Debug.Log(string.Format("{0}:{1}", responseMessage.rawRole, responseMessage.TextContent));
        output_string += string.Format("{0}:{1}", responseMessage.rawRole, responseMessage.TextContent) + "\n";
        tts.text_to_speech(responseMessage.TextContent); 
        animator.checkWordInChat(responseMessage.TextContent);

        //Add the response to the list of messages
        messages.Add(responseMessage);

        isTypeable = true; //typing unlock
    }
    private string input_string = "";
    private string output_string = "";
    private Vector2 scroll_pos = Vector2.zero;
    private int font_size = 20;
    private bool isTypeable = true;
    private void OnGUI()
    {
        //return;
        //Graphic User Interface 
        if (Event.current.type == EventType.KeyDown && Event.current.keyCode == KeyCode.Return)
        {
            GetResponse();
        }
        GUIStyle LabelStyle = new GUIStyle(GUI.skin.label);
        LabelStyle.fontSize = font_size;
        GUIStyle TextAreaStyle = new GUIStyle(GUI.skin.textArea);
        TextAreaStyle.fontSize = font_size;
        GUIStyle verticalScrollbar = GUI.skin.verticalScrollbar;

        GUILayout.BeginVertical();
        scroll_pos = GUILayout.BeginScrollView(scroll_pos, GUILayout.Width(400), GUILayout.Height(300));
        GUILayout.Label(output_string, TextAreaStyle);
        GUILayout.EndScrollView();
        scroll_pos.y = Mathf.Infinity; //scroll_pos update last line
        if (isTypeable)
        {
            input_string = GUILayout.TextField(input_string, TextAreaStyle);
        }
        else
        {
            GUILayout.Label(input_string, TextAreaStyle);
        }
        GUILayout.EndVertical();
    }
}
```

<img style='border:solid 1px black;' src="https://image.onethelab.com/resized/1722914617.jpg" />
* default_talk_animation은 기본 대화시 재생할 애니메이션의 이름을 기입
* trigger_list는 +를 눌러서 트리거가 될 단어와 재생할 애니메이션의 이름을 기입
* open ai controller의 personality에 단어가 더 자주 출현할 수 있도록 상황을 기입
