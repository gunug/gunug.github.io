---
layout: post
title: php
category: web
tags: php
---

# php
## 전체 데이터를 출력하는 php
* page.php

```php
<meta charset="utf-8" />
<style type="text/css">
	td{
		border: solid 1px #000;
	}
</style>
									
<?php

	$dbc = mysqli_connect('localhost', 'root', '', 'media_programming_2', '3306') or die('Error connecting to MySQL server.');
	//데이터 베이스 접속

	$query = "SELECT * FROM `sample_data`";
	$result = mysqli_query($dbc, $query) or die ('Error querying database');
	//쿼리문 수행하기

	echo "<table>";
	while($row=mysqli_fetch_row($result)){
		echo "<tr>";
		echo "<td>".$row[0]."</td>";
		echo "<td>".$row[1]."</td>";
		echo "<td>".$row[2]."</td>";
		echo "<td>".$row[3]."</td>";
		echo "<td>".$row[4]."</td>";
		echo "<td>".$row[5]."</td>";
		echo "<td>".$row[6]."</td>";
		echo "<td>".$row[7]."</td>";
		echo "<td>".$row[8]."</td>";
		echo "<td>".$row[9]."</td>";
		echo "<td>".$row[10]."</td>";
		echo "<td>".$row[11]."</td>";
		echo "<td>".$row[12]."</td>";
		echo "<td>".$row[13]."</td>";
		echo "<td>".$row[14]."</td>";
		echo "<td>".$row[15]."</td>";
		echo "</tr>";
	}
	echo "</table>";

	mysqli_close($dbc);
	//데이터 베이스 닫기
?>
```

---

# 전체 게시물 수 표시하기
* page.php

```php
$count_query = "SELECT COUNT(*) FROM `sample_data`";
$count_result = mysqli_query($dbc, $count_query) or die ('Error querying database');
$one_page = 20; //한 페이지에 표시할 게시물의 수
while($count_row=mysqli_fetch_row($count_result)){
	echo "총".$count_row[0]."개의 게시물이 있습니다.";
	echo "한 페이지에 ".$one_page."개씩 표시할 경우";
	$page_num = ceil($count_row[0]/$one_page);
	echo $page_num."페이지가 필요합니다.";
}
```

# 페이지 버튼 표시하기
* page.php

```php
echo "<table><tr>";
for($i=0; $i<$page_num; $i++){
	echo "<td><a href='page.php?page=".($i+1)."'>".($i+1)."</td>";
}
echo "</tr></table>";
```
# 쿼리문 수정하기

```php
<source lang="javascript" line>if(!isset($_GET['page'])){
	$_GET['page'] = 1;
}
$query = "SELECT * FROM `content` LIMIT ".(($_GET['page']-1)*$one_page).",".$one_page;
```

---

# 도메인명 알아내기

```php
$url1 = $_SERVER['PHP_SELF']; 
$url2 = dirname($_SERVER['PHP_SELF']); 
$url3 = basename($_SERVER['PHP_SELF']); 
$url4 = $_SERVER[HTTP_HOST];

echo $url1; echo $url2; echo $url3; echo $url4;
```

* 현재 웹문서의 주소가 http://sulfur.pe.kr/web/php/php011.html 일 경우 위 코드의 출력 결과는 다음과 같다. 필요한 대로 골라 쓰면 된다.

```php
$url1 결과 : http://sulfur.pe.kr/web/php/php011.html
$url2 결과 : /web/php/php011.html
$url3 결과 : /web/php php011.html
$url4 결과 : sulfur.pe.kr
```

---

# 쿠키(Cookie)
* 쿠키는 개별 사용자의 컴퓨터(local)에 변수를 저장
* 개별 사용자에게 다른 서비스를 제공하기 위함
  
## 쿠키의 생성

```php
<?php
setcookie("counter", "1", 30*24*60*60+time(), "/");
//쿠키의 이름은 counter, 쿠키의 값은 1, 쿠키는 현재시간부터 30일동안 보관됨, 
//루트(/) 이하 모든 디렉토리에서 읽기 가능
?>
```		
## 쿠키의 이용
```php
<?php
//echo $_COOKIE["counter"];
if(!is_null($_COOKIE)){
	//NOT 빈값 이다 (쿠키가)
	if(!is_null($_COOKIE["counter"])){
		//NOT 빈값 이다 (쿠키 counet)
		echo "counter 쿠키값은".$_COOKIE["counter"]."입니다.";
		//$_COOKIE["counter"] ++;
		setcookie("counter", $_COOKIE["counter"]+1, 30*24*60*60+time(), "/");
	}else{
		echo "counter 쿠키가 없습니다.";
	}
}else{
	echo "쿠키가 없습니다.";
}	
?>
```

## 쿠키의 폐기
{| class="wikitable"
```php
<?php
setcookie("counter", "", time(), "/");
?>
```

---
		                				
# 세션(Session)
* 쿠키와 마찬가지로 개별 사용자를 구별하기 위한 용도로 사용
* 쿠키와 달리 페이지를 닫을때 세션이 자동으로 닫힘

```php
<?php
$cnt;
session_start(); //세션을 시작하는 함수
if($_SESSION){
	if(!is_null($_SESSION["cnt"])){
		$cnt = $_SESSION["cnt"] + 1; 
		//세션변수 "cnt"이 있다면 본래의 숫자에 1을 더함
		$_SESSION["cnt"] = $cnt;
		//세션에 변수 "cnt"를 저장함
	}else{
		$_SESSION["cnt"] = 0;
	}
}else{
	$_SESSION["cnt"] = 0;
}

echo "귀하는 이 페이지를 ".$_SESSION["cnt"]."번째 새로고침 하였습니다."
?>
```

## 세션의 특이 사항
```php
<?php
session_start(); // 세션변수 사용하기 시작
session_register('passtype'); // 세션변수 등록
$_SESSION['passtype']; //세션변수 접근
$_SESSION['passtype']=10; //세션변수 입력
echo $_SESSION['passtype']; //세션변수 출력
?>
```

* 세션변수란 동일 브라우저내에서 계속 이어쓰는 변수이다.
* 세션변수 사용선언 > 세션변수등록 > 세션변수접근,사용 으로 이어진다.

* 세션변수는 http://로 시작하는 링크의 경우 같은 도메인이더라도 세션이 초기화된다.(상대주소나 /로 시작하는 절대주소를 사용하는것을 권장)
* 같은 도메인의 타 브라우져 사이에서는 세션이 유효하지 않다 (쿠키로 해결하는 것으로 생각됨)
